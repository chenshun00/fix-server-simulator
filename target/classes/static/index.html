<!DOCTYPE html>
<html ng-app="fixSimulatorApp">
<head>
    <meta charset="UTF-8">
    <title>FIX Server Simulator</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/app.css">
</head>
<body>
    <div class="container-fluid h-100">
        <div class="row h-100">
            <!-- Sidebar -->
            <div class="col-md-2 col-lg-2 d-md-block sidebar collapse" id="sidebar">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" ng-click="selectView('session-status')">
                                <i class="fas fa-server"></i>
                                Session状态
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" ng-click="selectView('message-query')">
                                <i class="fas fa-envelope"></i>
                                报文查询
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-10 ms-sm-auto col-lg-10 px-md-4 main-content">
                <div class="container-fluid py-3">
                    <!-- Session Status View -->
                    <div ng-if="currentView === 'session-status'" ng-controller="SessionStatusController as ctrl">
                        <h2>Session状态</h2>
                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Session Key</th>
                                        <th>Status</th>
                                        <th>Next Expected Seq</th>
                                        <th>Next Sender Seq</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="(key, session) in sessions">
                                        <td>{{ session.sessionKey }}</td>
                                        <td>
                                            <span ng-class="session.connected ? 'text-success' : 'text-danger'">
                                                {{ session.connected ? 'Connected' : 'Disconnected' }}
                                            </span>
                                        </td>
                                        <td>{{ session.nextExpectedMsgSeqNum }}</td>
                                        <td>{{ session.nextSenderMsgSeqNum }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Message Query View -->
                    <div ng-if="currentView === 'message-query'" ng-controller="MessageQueryController as ctrl">
                        <h2>报文查询</h2>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="ClOrdId" ng-model="searchParams.clOrdId">
                            </div>
                            <div class="col-md-4">
                                <input type="text" class="form-control" placeholder="Symbol" ng-model="searchParams.symbol">
                            </div>
                            <div class="col-md-4">
                                <button class="btn btn-primary" ng-click="searchMessages()">搜索</button>
                                <button class="btn btn-secondary ms-2" ng-click="clearSearch()">清空</button>
                            </div>
                        </div>

                        <div class="table-responsive">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>ClOrdId</th>
                                        <th>Symbol</th>
                                        <th>MsgType</th>
                                        <th>Direction</th>
                                        <th>Receive Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="message in messages">
                                        <td>{{ message.id }}</td>
                                        <td>{{ message.parsedField.clOrdId }}</td>
                                        <td>{{ message.parsedField.symbol }}</td>
                                        <td>{{ message.msgType }}</td>
                                        <td>{{ message.direction }}</td>
                                        <td>{{ message.receiveTime | date:'yyyy-MM-dd HH:mm:ss' }}</td>
                                        <td>
                                            <button class="btn btn-sm btn-outline-primary" ng-click="openReplyModal(message)">回报</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <nav aria-label="Page navigation">
                            <ul class="pagination">
                                <li class="page-item" ng-class="{disabled: currentPage === 0}">
                                    <a class="page-link" href="#" ng-click="changePage(currentPage - 1)">Previous</a>
                                </li>
                                <li class="page-item" ng-repeat="page in getPageNumbers()" ng-class="{active: page === currentPage}">
                                    <a class="page-link" href="#" ng-click="changePage(page)">{{ page + 1 }}</a>
                                </li>
                                <li class="page-item" ng-class="{disabled: currentPage === totalPages - 1}">
                                    <a class="page-link" href="#" ng-click="changePage(currentPage + 1)">Next</a>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Reply Modal -->
    <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="replyModalLabel">回报操作</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">回报类型</label>
                            <select class="form-select" ng-model="replyData.replyType">
                                <option value="new">已报 (New)</option>
                                <option value="partial-fill">部分成交</option>
                                <option value="fill">完全成交</option>
                                <option value="reject">拒绝</option>
                                <option value="modify">改单确认</option>
                                <option value="cancel">撤单确认</option>
                            </select>
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType !== 'new' && replyData.replyType !== 'reject'">
                            <label class="form-label">ExecType</label>
                            <select class="form-select" ng-model="replyData.execType">
                                <option value="0">New (0)</option>
                                <option value="1">Partially Filled (1)</option>
                                <option value="2">Filled (2)</option>
                                <option value="4">Canceled (4)</option>
                                <option value="5">Replaced (5)</option>
                                <option value="8">Rejected (8)</option>
                                <option value="C">Expired (C)</option>
                            </select>
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType !== 'new' && replyData.replyType !== 'reject'">
                            <label class="form-label">OrdStatus</label>
                            <select class="form-select" ng-model="replyData.ordStatus">
                                <option value="0">New (0)</option>
                                <option value="1">Partially Filled (1)</option>
                                <option value="2">Filled (2)</option>
                                <option value="4">Canceled (4)</option>
                                <option value="5">Replaced (5)</option>
                                <option value="8">Rejected (8)</option>
                                <option value="C">Expired (C)</option>
                            </select>
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType === 'partial-fill' || replyData.replyType === 'fill'">
                            <label class="form-label">LastQty</label>
                            <input type="number" class="form-control" ng-model="replyData.lastQty">
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType === 'partial-fill' || replyData.replyType === 'fill'">
                            <label class="form-label">CumQty</label>
                            <input type="number" class="form-control" ng-model="replyData.cumQty">
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType === 'partial-fill' || replyData.replyType === 'fill'">
                            <label class="form-label">LeavesQty</label>
                            <input type="number" class="form-control" ng-model="replyData.leavesQty">
                        </div>
                        <div class="mb-3" ng-show="replyData.replyType === 'reject'">
                            <label class="form-label">Reject Text</label>
                            <input type="text" class="form-control" ng-model="replyData.rejectText">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" ng-click="sendReply()">发送回报</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- AngularJS -->
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.2/angular.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Application Scripts -->
    <script src="/js/app.js"></script>
    <script src="/js/controllers/session-status.controller.js"></script>
    <script src="/js/controllers/message-query.controller.js"></script>
    <script src="/js/services/session.service.js"></script>
    <script src="/js/services/message.service.js"></script>
    <script src="/js/services/reply.service.js"></script>
</body>
</html>